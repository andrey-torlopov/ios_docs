# HitTest


- üüß [HitTest —Å—Ç–∞—Ç—å—è Medium](https://medium.com/yandex-maps-mobile/–¥–µ—Ä–∂–∏–º-—É–¥–∞—Ä-—Å-hittest-542653d51a8c)
- üüß [Hit-testing in iOS](https://smnh.me/hit-testing-in-ios)

### –ö—Ä–∞—Ç–∫–æ–µ —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ —Å—Ç–∞—Ç—å–∏ "–î–µ—Ä–∂–∏–º —É–¥–∞—Ä —Å hitTest"

**–û—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ç–æ–¥—ã:**
1. **hitTest(_:with:)**

```swift
override func hitTest(_ point: CGPoint, with event: UIEvent?) -> UIView? {
    guard isUserInteractionEnabled else { return nil }
    guard !isHidden else { return nil }
    guard alpha >= 0.01 else { return nil }
    guard point(inside: point, with: event) else { return nil }
    
    for subview in subviews.reversed() {
        let convertedPoint = subview.convert(point, from: self)
        if let hitView = subview.hitTest(convertedPoint, with: event) {
            return hitView
        }
    }
    return self
}
```
**–û–ø–∏—Å–∞–Ω–∏–µ:** –ú–µ—Ç–æ–¥ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç, –∫–∞–∫–∞—è –≤—å—é –∏–µ—Ä–∞—Ä—Ö–∏–∏ –¥–æ–ª–∂–Ω–∞ –ø–æ–ª—É—á–∏—Ç—å —Å–æ–±—ã—Ç–∏–µ –∫–∞—Å–∞–Ω–∏—è.

2. **point(inside:with:)**

```swift
override func point(inside point: CGPoint, with event: UIEvent?) -> Bool {
    let inside = super.point(inside: point, with: event)
    if !inside {
        for subview in subviews {
            let pointInSubview = subview.convert(point, from: self)
            if subview.point(inside: pointInSubview, with: event) {
                return true
            }
        }
    }
    return inside
}
```
**–û–ø–∏—Å–∞–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –ª–∏ —Ç–æ—á–∫–∞ –∫–∞—Å–∞–Ω–∏—è –≤–Ω—É—Ç—Ä–∏ –≤—å—é –∏–ª–∏ –µ—ë –ø–æ–¥–≤–∏–¥–æ–≤.

### –û—Å–Ω–æ–≤–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã:

1. **–û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–∞—Å–∞–Ω–∏—è:** –°–æ–±—ã—Ç–∏—è –∫–∞—Å–∞–Ω–∏—è —Å–æ–∑–¥–∞—é—Ç—Å—è –∏ –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ `UIApplication`, –∫–æ—Ç–æ—Ä—ã–π –Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç –∏—Ö –≤ `UIWindow`.
2. **–†–µ–∫—É—Ä—Å–∏–≤–Ω—ã–π –ø–æ–∏—Å–∫:** –ú–µ—Ç–æ–¥ `hitTest` —Ä–µ–∫—É—Ä—Å–∏–≤–Ω–æ –∏—â–µ—Ç —Å–∞–º—É—é –≥–ª—É–±–æ–∫—É—é –≤—å—é, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â—É—é —Ç–æ—á–∫–µ –∫–∞—Å–∞–Ω–∏—è.
3. **–ò–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–ª–∏–∫–æ–≤:** –ï—Å–ª–∏ —Ç–æ—á–∫–∞ –∫–∞—Å–∞–Ω–∏—è –≤–Ω–µ –≥—Ä–∞–Ω–∏—Ü –≤—å—é, –æ–Ω–∞ –∏ –µ—ë –ø–æ–¥–≤–∏–¥—ã –∏–≥–Ω–æ—Ä–∏—Ä—É—é—Ç—Å—è.

–≠—Ç–∏ –º–µ—Ç–æ–¥—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¥–ª—è —Ç–æ—á–Ω–æ–≥–æ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –ø–æ–ª—É—á–∞—Ç–µ–ª—è —Å–æ–±—ã—Ç–∏–π –∫–∞—Å–∞–Ω–∏—è –≤ –∏–µ—Ä–∞—Ä—Ö–∏–∏ –≤—å—é, —á—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Å–ª–æ–∂–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è –∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã.

--- 
–û–¥–Ω–∞–∫–æ, —è –º–æ–≥—É —Ä–∞—Å—Å–∫–∞–∑–∞—Ç—å –æ –∫–ª—é—á–µ–≤—ã—Ö –º–µ—Ç–æ–¥–∞—Ö, —Å–≤—è–∑–∞–Ω–Ω—ã—Ö —Å –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –∂–µ—Å—Ç–æ–≤ –∏ —Å–æ–±—ã—Ç–∏–π –≤ iOS, –æ—Å–Ω–æ–≤–∞–Ω–Ω—ã—Ö –Ω–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ –º–µ—Ç–æ–¥–æ–≤ `hitTest` –∏ `pointInside`.

### –ö–ª—é—á–µ–≤—ã–µ –º–µ—Ç–æ–¥—ã:

1. **hitTest(_:with:)**

```swift
override func hitTest(_ point: CGPoint, with event: UIEvent?) -> UIView? {
    if !self.isUserInteractionEnabled || self.isHidden || self.alpha <= 0.01 {
        return nil
    }
    
    if self.point(inside: point, with: event) {
        for subview in self.subviews.reversed() {
            let convertedPoint = subview.convert(point, from: self)
            if let hitTestView = subview.hitTest(convertedPoint, with: event) {
                return hitTestView
            }
        }
        return self
    }
    return nil
}
```
**–û–ø–∏—Å–∞–Ω–∏–µ**: –≠—Ç–æ—Ç –º–µ—Ç–æ–¥ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç, –∫–∞–∫–æ–π –≤—å—é –¥–æ–ª–∂–µ–Ω –ø–æ–ª—É—á–∞—Ç—å —Å–æ–±—ã—Ç–∏–µ –∫–∞—Å–∞–Ω–∏—è. –û–Ω —Å–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç, –º–æ–∂–µ—Ç –ª–∏ –≤—å—é –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è, –∑–∞—Ç–µ–º –ø—Ä–æ–≤–µ—Ä—è–µ—Ç, –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –ª–∏ —Ç–æ—á–∫–∞ –∫–∞—Å–∞–Ω–∏—è –≤–Ω—É—Ç—Ä–∏ –≥—Ä–∞–Ω–∏—Ü –≤—å—é. –ï—Å–ª–∏ –¥–∞, –æ–Ω —Ä–µ–∫—É—Ä—Å–∏–≤–Ω–æ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –ø–æ–¥–≤–∏–¥—ã (subviews) –≤—å—é. –ï—Å–ª–∏ –Ω–∏ –æ–¥–∏–Ω –∏–∑ –ø–æ–¥–≤–∏–¥–æ–≤ –Ω–µ –ø–æ–¥—Ö–æ–¥–∏—Ç, —Ç–µ–∫—É—â–∞—è –≤—å—é –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –∫–∞–∫ –ø–æ–ª—É—á–∞—Ç–µ–ª—å —Å–æ–±—ã—Ç–∏—è.

2. **pointInside(_:with:)**

```swift
override func point(inside point: CGPoint, with event: UIEvent?) -> Bool {
    return self.bounds.contains(point)
}
```
**–û–ø–∏—Å–∞–Ω–∏–µ**: –≠—Ç–æ—Ç –º–µ—Ç–æ–¥ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç, –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –ª–∏ —Ç–æ—á–∫–∞ –∫–∞—Å–∞–Ω–∏—è –≤–Ω—É—Ç—Ä–∏ –≥—Ä–∞–Ω–∏—Ü –≤—å—é. –≠—Ç–æ –ø–æ–º–æ–≥–∞–µ—Ç –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å, —Å–ª–µ–¥—É–µ—Ç –ª–∏ —É—á–∏—Ç—ã–≤–∞—Ç—å —ç—Ç—É –≤—å—é –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å–æ–±—ã—Ç–∏–π –∫–∞—Å–∞–Ω–∏—è.

### –ü—Ä–∏–º–µ—Ä –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–æ–±—ã—Ç–∏–π:

1. **–ö–∞—Å–∞–Ω–∏–µ —ç–∫—Ä–∞–Ω–∞**: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∫–∞—Å–∞–µ—Ç—Å—è —ç–∫—Ä–∞–Ω–∞, —Å–æ–∑–¥–∞–µ—Ç—Å—è —Å–æ–±—ã—Ç–∏–µ `UIEvent`.
2. **–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ–ª—É—á–∞—Ç–µ–ª—è**: –°–æ–±—ã—Ç–∏–µ –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –≤ –∫–æ—Ä–Ω–µ–≤—É—é –≤—å—é, –∫–æ—Ç–æ—Ä–∞—è –≤—ã–∑—ã–≤–∞–µ—Ç –º–µ—Ç–æ–¥ `hitTest(_:with:)`.
3. **–†–µ–∫—É—Ä—Å–∏–≤–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞**: `hitTest(_:with:)` —Ä–µ–∫—É—Ä—Å–∏–≤–Ω–æ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –≤—Å–µ –ø–æ–¥–≤–∏–¥—ã, –≤—ã–∑—ã–≤–∞—è –º–µ—Ç–æ–¥ `pointInside(_:with:)` –¥–ª—è –∫–∞–∂–¥–æ–π –≤—å—é, —á—Ç–æ–±—ã –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å, –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –ª–∏ —Ç–æ—á–∫–∞ –∫–∞—Å–∞–Ω–∏—è –≤–Ω—É—Ç—Ä–∏ –Ω–µ–µ.
4. **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ–ª—É—á–∞—Ç–µ–ª—è**: –ö–∞–∫ —Ç–æ–ª—å–∫–æ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∞—è –≤—å—é –Ω–∞–π–¥–µ–Ω–∞, –æ–Ω–∞ –Ω–∞–∑–Ω–∞—á–∞–µ—Ç—Å—è –ø–æ–ª—É—á–∞—Ç–µ–ª–µ–º —Å–æ–±—ã—Ç–∏—è –∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –µ–≥–æ.

–≠—Ç–∏ –º–µ—Ç–æ–¥—ã –∏–≥—Ä–∞—é—Ç –∫–ª—é—á–µ–≤—É—é —Ä–æ–ª—å –≤ —Å–∏—Å—Ç–µ–º–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–æ–±—ã—Ç–∏–π iOS, –ø–æ–∑–≤–æ–ª—è—è —Ç–æ—á–Ω–æ –æ–ø—Ä–µ–¥–µ–ª—è—Ç—å, –∫–∞–∫–∞—è –≤—å—é –¥–æ–ª–∂–Ω–∞ –ø–æ–ª—É—á–∞—Ç—å –∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –∫–∞—Å–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
